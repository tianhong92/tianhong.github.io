---
title: JUC-ForkJoin
date: 2018-10-04 13:35:32
tags:
---

Java 7 提供的用于并行执行任务的框架， 把大任务分为多个小任务， 再汇总每个小任务结果得到大任务结果

# Fork Join框架 
* Fork 把大任务分为多个小任务并行执行
* Join 合并子任务结果
* 工作窃取算法， 使用双端队列， 窃取线程从被窃取线程队列尾部开始拿任务， 被窃取线程从头部开始拿任务。减少线程竞争， 某些场合还是有竞争， 比如双端队列只有一个任务时候。

## 局限性

1. 任务只能通过fork join来同步
2. 小任务不能执行IO任务

# Blocking Queue

阻塞的情况：
1. 队列满了入队
2. 队列空出队
阻塞队列是线程安全的， 其实就是一个线程生产， 另外一个线程消费的场景

实现类
1. ArrayBlockingQueue: 有界阻塞队列， 容量有限， 初始化时候定大小。 先进先出。
2. DelayQueue: 无界阻塞队列，继承comparable接口， 因为delayqueue内部元素需要排序。 一般按元素过期时间优先级进行排序。 用于定时关闭连接， 缓存对象， 超时处理。内部实现用到锁和排序
3. LinkedBlockingQueue: 初始化指定大小就是有边界， 不然无边界。 
4. PriorityBlcokingQueue： 允许null对象， 无边界有排序规则。
5. SynchronousQueue: 只允许容纳一个元素， 有一个元素就阻塞。


